== UC 1.2 tutorial on creating JSON-LD context

=== Introduction

Public administrations often need to share information about their services with other organisations and the public. To do this effectively, the data must be easy to understand and work seamlessly across different systems. However, public services are becoming more complex, which means we need to capture more details, concepts, and relationships to handle various use cases. +
The Core Public Service Vocabulary Application Profile (https://github.com/SEMICeu/CPSV-AP/tree/master[*CPSV-AP]*) provides a generic framework to describe public services in a machine-readable way. It helps public administrations share and organise information about services. However, sometimes CPSV-AP needs to be extended with new concepts or restrictions to address more general or specific use cases. +
For example, the terms Service and RequiredEvidence were introduced in https://github.com/Informasjonsforvaltning/cpsv-ap-no[CPSV-AP-NO] to extend the CPSV-AP model such that it can fulfil the specific needs identified in Norway, where:

. Service allows for describing not only public services but also general ones, enabling the representation of services provided through partnerships or private organisations.
. RequiredEvidence provides a way to explicitly define the documentation or credentials needed to access a service, such as proof of address for health insurance registration.
To make CPSV-AP more flexible and useful, creating a JSON-LD context is essential. JSON-LD helps structure the data so it can be easily shared and understood by different systems. This tutorial addresses the use case https://semiceu.github.io/core-vocs-handbook/public-review/use-cases.html#:~:text=Use%20Case%20UC1.2%3A%20Create%20a%20new%20JSON%2DLD%20context%20definition[UC1.2], and will show how to create a JSON-LD context for an Application Profile that extends CPSV-AP with new concepts like *Service* and *RequiredEvidence*, which are defined by reusing concepts from the link:https://github.com/SEMICeu/Core-Business-Vocabulary[Core Business Vocabulary (CBV)], following ideas from CPSV-AP-NO. +
By extending CPSV-AP and using JSON-LD, public administrations can better organise their data, making it easier to share and integrate across systems while supporting a wider range of use cases.

=== Steps to create a JSON-LD context

====  Import or define elements:
Since CPSV-AP provides an existing JSON-LD context, we can import it in our own JSON-LD context using the @import statement. For example, in case of https://github.com/SEMICeu/CPSV-AP/blob/master/releases/3.2.0/context/cpsv-ap.jsonld[CPSV-AP version 3.2.0], the context can be directly reused like this:
[source,json]
  {
  "@context": {
    "@import": "https://raw.githubusercontent.com/SEMICeu/CPSV-AP/master/releases/3.2.0/context/cpsv-ap.jsonld"
  }
}


If a context that we can reuse does not exist, define the elements explicitly. For example, CPSV-AP uses specific terms such as PublicService and ContactPoint. These terms must be mapped to URIs.
[source,json]
  {
  "@context": {
    "PublicService": "http://purl.org/vocab/cpsv#PublicService",
    "ContactPoint": "http://data.europa.eu/m8g/ContactPoint"
  }
}


If a context needs to be extended, define the new elements explicitly. For example, if we need new terms (classes), such as Service and RequiredEvidence, which are not in CPSV-AP these terms must be mapped to URIs (the examples are inspired from https://github.com/Informasjonsforvaltning/cpsv-ap-no[CPSV-AP-NO]) :
[source,json]
 {
  "@context": {
    "Service": "http://example.com/cpsvap#Service",
    "RequiredEvidence": "http://example.com/cpsvap#RequiredEvidence"
  }
}



==== Shape the structure
Once you've imported or defined the relevant terms, you need to structure your JSON-LD context to reflect the relationships between the classes and their properties. This allows you to describe public services and their details in a standardised and machine-readable format. +
Let’s look at an link:https://tinyurl.com/2794ygga[example] where we define a Service and some of its key properties, such as contactPoint, description, name and hasRequiredEvidence.
[source,json]
  {
  "@context": {
    "@import": "https://raw.githubusercontent.com/SEMICeu/CPSV-AP/master/releases/3.2.0/context/cpsv-ap.jsonld",
    "Service": "http://example.com/cpsvap#Service",
    "Service.hasRequiredEvidence": {
      "@id": "http://example.com/cpsvap#RequiredEvidence",
      "@container": "@set"
    },
    "Service.description": {
      "@id": "http://purl.org/dc/terms/description",
      "@type": "http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",
      "@container": "@set"
    },
    "Service.name": {
      "@id": "http://purl.org/dc/terms/title",
      "@type": "http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",
      "@container": "@set"
    },
    "Service.contactPoint": {
      "@id": "http://data.europa.eu/m8g/contactPoint",
      "@type": "@id",
      "@container": "@set"
    }
  }
}


===== Explanation of JSON-LD keywords used

* *@context*: Defines the mapping between terms (e.g., PublicService) and their corresponding IRIs.
* *@container*: Specifies how values are structured. For instance,
**  @set: Explicitly defines a property as an *array of values*. It ensures that even if the data includes just one value, it will still be treated as an array by JSON-LD processors. This makes post-processing of JSON-LD documents easier as the data is always in array form, even if the array only contains a single value
* *@id*: Provides the unique identifier (IRI) for a term or property.
* *@type*: Specifies the type of a value. Commonly used for linking to classes or data types.
* *@import*:  Imports another JSON-LD context, allowing reuse of its terms.

==== Example of a simple service instance
After defining the context and structure, you can now describe an actual Service instance by referencing the terms you defined earlier.

===== Example scenario

Let’s assume a public administration offers a service called *"Health Insurance Registration"*. This service allows citizens to register for health insurance, which requires certain documents (evidence) to complete the process. Citizens might need to contact the administration for guidance, and the service details should be structured in a way that makes it easy to share and integrate across systems. +
To illustrate this, we’ve created a JSON-LD context representation  of this service, highlighting

* The required evidence for registration (e.g., Proof of Address).
* The service's name and description for clarity.
* Contact information for users who may need assistance.
Try this in JSON-LD Playground link:https://tinyurl.com/2fztw96p[here]

[source,json]
{
  "@context": [
    "https://raw.githubusercontent.com/SEMICeu/CPSV-AP/master/releases/3.2.0/context/cpsv-ap.jsonld",
    {
      "ex": "http://example.org/vocab/",
      "ex:hasTelephone": {
        "@type": "xsd:string"
      }
    }
  ],
  "@id": "http://example.org/service/healthInsuranceRegistration",
  "@type": "PublicService",
  "dct:title": {
    "@value": "Health Insurance Registration",
    "@language": "en"
  },
  "dct:description": {
    "@value": "A service for registering for health insurance.",
    "@language": "en"
  },
  "cpsv:hasRequiredEvidence": {
    "@id": "http://example.org/RequiredEvidence/ProofOfAddress",
    "dct:title": {
      "@value": "Proof of Address",
      "@language": "en"
    }
  },
  "cpsv:contactPoint": {
    "@type": "ContactPoint",
    "ex:hasTelephone": "+420776723338"
  }
}



==== Aliasing keywords for API compatibility (REST API example)

When working with REST APIs, it is often beneficial to alias certain JSON-LD keywords for simpler or more consistent representations in client applications. For example, you might alias JSON-LD's `@id` to `url` and `@type` to `type` to make the data more intuitive for API consumers, especially when working with legacy systems or client-side frameworks that use specific naming conventions.

===== Example of aliasing keywords

[source,json]

{
  "@context": {
    "url": "@id",
    "type": "@type",
    "Service": "http://data.europa.eu/m8g/cpsv#PublicService",
    "Service.name": "http://purl.org/dc/terms/title",
    "Service.description": "http://purl.org/dc/terms/description"
  },
  "url": "http://example.com/service/healthInsuranceRegistration",
  "type": "Service",
  "Service.name": "Health Insurance Registration",
  "Service.description": "A service for registering for health insurance."
}


In this example:

- `url` is an alias for `@id`
- `type` is an alias for `@type`

By aliasing these terms, the API responses are simplified and more familiar to the developers interacting with the service, especially if they are accustomed to a different JSON structure.

==== Extend the context by reusing terms from Core Vocabularies
To highlight the reuse of terms from existing CVs, we can import the *Core Business Vocabulary (CBV)* context alongside the *CPSV-AP context* to gain access to business-related terms. This step ensures that you can use the additional terms from *CBV*, such as LegalEntity, Organisation, and ContactPoint, to enrich your *Service* descriptions.
[source,json]
  {
  "@context": [
    {
      "@import": "https://raw.githubusercontent.com/SEMICeu/CPSV-AP/master/releases/3.2.0/context/cpsv-ap.jsonld"
    },
    {
      "@import": "https://raw.githubusercontent.com/SEMICeu/Core-Business-Vocabulary/master/releases/2.2.0/context/core-business-ap.jsonld"
    }
  ]
}


====  Define additional properties from the Core Business Vocabulary
Add CBV terms to enhance the description of the Service entity.
[source,json]
  {
  "@context": {
    "Service.providedBy": {
      "@id": "http://example.com/legal#providedBy",
      "@type": "http://example.com/legal#LegalEntity"
    },
    "LegalEntity": "http://www.w3.org/ns/legal#LegalEntity"
  }
}



==== Map extended properties in a service instance:
Use the extended properties to describe more aspects of *Service* instances. For link:https://tinyurl.com/zke95vmc[example]:


[source,json]

 {
  "@context": [
    "https://raw.githubusercontent.com/SEMICeu/CPSV-AP/master/releases/3.2.0/context/cpsv-ap.jsonld",
        "https://raw.githubusercontent.com/SEMICeu/Core-Business-Vocabulary/master/releases/2.2.0/context/core-business-ap.jsonld",
    {
      "ex": "http://example.org/vocab/",
      "ex:hasTelephone": {
        "@type": "xsd:string"
      }
    }
  ],
  "@id": "http://example.org/service/healthInsuranceRegistration",
  "@type": "PublicService",
  "dct:title": {
    "@value": "Health Insurance Registration",
    "@language": "en"
  },
  "dct:description": {
    "@value": "A service for registering for health insurance.",
    "@language": "en"
  },
  "cpsv:hasRequiredEvidence": {
    "@id": "http://example.org/RequiredEvidence/ProofOfAddress",
    "dct:title": {
      "@value": "Proof of Address",
      "@language": "en"
    }
  },
  "cpsv:contactPoint": {
    "@type": "ContactPoint",
    "ex:hasTelephone": "+420776723338"
  },
  "cpsv:providedBy": {
    "@id": "http://example.org/legalEntity/healthDepartment",
    "@type": "LegalEntity"
  }
}




==== Final review and validation
Use an online tool such as the https://json-ld.org/playground/[JSON-LD Playground ]to validate JSON-LD context and make sure there are no errors.

image::image-2025-04-14-14-26-17-475.png[]

==== Error example:

If the `@import` URLs for external contexts are incorrect or unavailable, the validation tool may display an error such as:

* "Error loading remote context" or
* "Context could not be retrieved."

[source,json]
----
{
  "@context": [
    { "@import": "https://invalid-url/cpsv-ap.jsonld" }
  ]
}
----
These errors typically occur when the referenced context URL is malformed or unreachable, as shown in the following figure:

image::image-2025-04-22-22-04-11-289.png[Example error shown in the validator interface]

==== How to fix:

Ensure that the @import URLs point to valid and accessible JSON-LD contexts. Verify the links in a browser or test them in a cURL command to ensure they return the correct JSON-LD data. Update the URLs to the correct ones.
